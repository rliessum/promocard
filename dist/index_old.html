<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promo Card Generator</title>
    <link href="output.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body class="bg-black text-white min-h-screen font-inter overflow-x-hidden">

    <!-- Header -->
    <header class="border-b border-gray-800 bg-black/95 backdrop-blur-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z"/>
                        </svg>
                    </div>
                    <h1 class="text-xl font-bold">Promo Card Generator</h1>
                </div>
                <div class="flex items-center gap-3">
                    <button id="resetBtn" class="text-gray-400 hover:text-white transition-colors p-2 rounded-full hover:bg-gray-800" title="Reset to defaults">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                    </button>
                    <button id="downloadBtn" class="bg-green-500 hover:bg-green-600 text-black font-semibold px-6 py-2 rounded-full transition-all duration-200 transform hover:scale-105 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        <span id="downloadBtnText">Download</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid lg:grid-cols-12 gap-8">
            
            <!-- Left Panel - Controls -->
            <div class="lg:col-span-4 space-y-6">
                
                <!-- Navigation Tabs -->
                <div class="bg-gray-900/50 rounded-xl p-1 flex">
                    <button id="tabBasic" class="tab-btn flex-1 text-sm font-medium py-2 px-4 rounded-lg transition-all bg-white text-black">
                        Basic
                    </button>
                    <button id="tabStyle" class="tab-btn flex-1 text-sm font-medium py-2 px-4 rounded-lg transition-all text-gray-400 hover:text-white">
                        Style
                    </button>
                    <button id="tabExport" class="tab-btn flex-1 text-sm font-medium py-2 px-4 rounded-lg transition-all text-gray-400 hover:text-white">
                        Export
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="space-y-6">
                    
                    <!-- Basic Tab -->
                    <div id="basicTab" class="tab-content">
                        <div class="bg-gray-900/30 rounded-xl p-6 space-y-6">
                            
                            <!-- Artist Name -->
                            <div class="space-y-2">
                                <label for="artistName" class="block text-sm font-medium text-gray-300">Artist Name</label>
                                <input type="text" id="artistName" value="Your Name" 
                                       class="w-full bg-gray-800/50 border border-gray-700 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all placeholder-gray-500"
                                       placeholder="Enter artist name">
                            </div>

                            <!-- Tagline -->
                            <div class="space-y-2">
                                <label for="tagline" class="block text-sm font-medium text-gray-300">Tagline</label>
                                <input type="text" id="tagline" value="New Single Out Now" 
                                       class="w-full bg-gray-800/50 border border-gray-700 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all placeholder-gray-500"
                                       placeholder="Enter tagline">
                            </div>

                            <!-- Brand Name -->
                            <div class="space-y-2">
                                <label for="brandName" class="block text-sm font-medium text-gray-300">Brand</label>
                                <input type="text" id="brandName" value="YourBrand" 
                                       class="w-full bg-gray-800/50 border border-gray-700 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all placeholder-gray-500"
                                       placeholder="Enter brand name">
                            </div>

                            <!-- Image Upload -->
                            <div class="space-y-2">
                                <label class="block text-sm font-medium text-gray-300">Artist Image</label>
                                <div class="relative">
                                    <input type="file" id="imageUpload" accept="image/*" class="hidden">
                                    <label for="imageUpload" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-600 rounded-lg cursor-pointer hover:border-green-500 transition-colors bg-gray-800/30 hover:bg-gray-800/50">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 mb-2"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
                                        <span class="text-sm text-gray-400">Click to upload image</span>
                                        <span class="text-xs text-gray-500 mt-1">JPG, PNG up to 10MB</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Style Tab -->
                    <div id="styleTab" class="tab-content hidden">
                        <div class="bg-gray-900/30 rounded-xl p-6 space-y-6">
                            
                            <!-- Background Color -->
                            <div class="space-y-3">
                                <label for="bgColor" class="block text-sm font-medium text-gray-300">Background Color</label>
                                <div class="space-y-3">
                                    <input type="color" id="bgColor" value="#1DB954" class="w-full h-12 p-1 bg-gray-800/50 border border-gray-700 rounded-lg cursor-pointer">
                                    
                                    <!-- Color Presets -->
                                    <div class="grid grid-cols-6 gap-2">
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition ring-2 ring-white" style="background-color: #1DB954;" data-color="#1DB954" title="Spotify Green"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #FF6B6B;" data-color="#FF6B6B" title="Coral Red"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #4ECDC4;" data-color="#4ECDC4" title="Turquoise"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #45B7D1;" data-color="#45B7D1" title="Sky Blue"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #96CEB4;" data-color="#96CEB4" title="Mint Green"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #FFEAA7;" data-color="#FFEAA7" title="Light Yellow"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #DDA0DD;" data-color="#DDA0DD" title="Plum"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #98D8C8;" data-color="#98D8C8" title="Mint"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #F7DC6F;" data-color="#F7DC6F" title="Golden"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #BB8FCE;" data-color="#BB8FCE" title="Lavender"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #85C1E9;" data-color="#85C1E9" title="Light Blue"></button>
                                        <button class="color-preset w-8 h-8 rounded-lg border-2 border-gray-600 hover:border-white transition" style="background-color: #F8C471;" data-color="#F8C471" title="Peach"></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Font Size Controls -->
                            <div class="space-y-4">
                                <label class="block text-sm font-medium text-gray-300">Font Sizes</label>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <label for="artistNameSize" class="text-xs text-gray-400">Artist Name</label>
                                            <span id="artistNameSizeValue" class="text-xs text-gray-400">48px</span>
                                        </div>
                                        <input type="range" id="artistNameSize" min="24" max="72" value="48" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider">
                                    </div>
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <label for="taglineSize" class="text-xs text-gray-400">Tagline</label>
                                            <span id="taglineSizeValue" class="text-xs text-gray-400">20px</span>
                                        </div>
                                        <input type="range" id="taglineSize" min="12" max="32" value="20" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider">
                                    </div>
                                    <div>
                                        <div class="flex justify-between items-center mb-2">
                                            <label for="brandSize" class="text-xs text-gray-400">Brand</label>
                                            <span id="brandSizeValue" class="text-xs text-gray-400">24px</span>
                                        </div>
                                        <input type="range" id="brandSize" min="16" max="40" value="24" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider">
                                    </div>
                                </div>
                            </div>

                            <!-- Aspect Ratio -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Card Size</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="aspectSquare" class="aspect-btn bg-green-600 border border-green-500 text-white p-3 rounded-lg text-sm font-medium transition-all hover:bg-green-700">
                                        Square<br><span class="text-xs opacity-75">1:1</span>
                                    </button>
                                    <button id="aspectStory" class="aspect-btn bg-gray-700 border border-gray-600 text-white p-3 rounded-lg text-sm font-medium transition-all hover:bg-gray-600">
                                        Story<br><span class="text-xs opacity-75">9:16</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Export Tab -->
                    <div id="exportTab" class="tab-content hidden">
                        <div class="bg-gray-900/30 rounded-xl p-6 space-y-6">
                            
                            <!-- Format Selection -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Export Format</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <button id="formatPNG" class="format-btn bg-green-600 border border-green-500 text-white p-3 rounded-lg text-sm font-medium transition-all">PNG</button>
                                    <button id="formatJPG" class="format-btn bg-gray-700 border border-gray-600 text-white p-3 rounded-lg text-sm font-medium transition-all hover:bg-gray-600">JPG</button>
                                    <button id="formatWEBP" class="format-btn bg-gray-700 border border-gray-600 text-white p-3 rounded-lg text-sm font-medium transition-all hover:bg-gray-600">WEBP</button>
                                </div>
                            </div>
                            
                            <!-- Quality/Scale -->
                            <div class="space-y-3">
                                <label for="exportScale" class="block text-sm font-medium text-gray-300">Export Quality</label>
                                <select id="exportScale" class="w-full bg-gray-800/50 border border-gray-700 text-white rounded-lg px-4 py-3 focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all">
                                    <option value="1">Standard (1x)</option>
                                    <option value="2" selected>High Quality (2x)</option>
                                    <option value="3">Ultra High (3x)</option>
                                </select>
                            </div>

                            <!-- Social Media Presets -->
                            <div class="space-y-3">
                                <label class="block text-sm font-medium text-gray-300">Quick Resize</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button id="instagramSquare" class="social-preset bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-lg text-xs font-medium transition-all">
                                        IG Square<br><span class="text-xs opacity-75">1080x1080</span>
                                    </button>
                                    <button id="instagramStory" class="social-preset bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-lg text-xs font-medium transition-all">
                                        IG Story<br><span class="text-xs opacity-75">1080x1920</span>
                                    </button>
                                    <button id="twitterPost" class="social-preset bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-lg text-xs font-medium transition-all">
                                        Twitter<br><span class="text-xs opacity-75">1200x675</span>
                                    </button>
                                    <button id="facebookPost" class="social-preset bg-gray-700 hover:bg-gray-600 text-white p-3 rounded-lg text-xs font-medium transition-all">
                                        Facebook<br><span class="text-xs opacity-75">1200x630</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Preview -->
            <div class="lg:col-span-8 flex items-center justify-center p-6">
                <div class="w-full max-w-lg">
                    <div id="cardPreviewWrapper" class="w-full">
                        <div id="promoCard" class="aspect-square w-full rounded-2xl shadow-2xl p-8 sm:p-10 lg:p-12 flex flex-col justify-between transition-all duration-300" style="background-color: #1DB954;">
                            <!-- Top section: Image and Text -->
                            <div class="flex-grow flex flex-col items-center justify-center text-center">
                                <img id="previewImage" src="https://placehold.co/400x400/222/FFF?text=ARTIST" onerror="this.onerror=null; this.src='https://placehold.co/400x400/222/FFF?text=Error'" alt="Artist" class="w-48 h-48 sm:w-56 sm:h-56 lg:w-64 lg:h-64 rounded-full object-cover mb-6 shadow-lg border-4 border-white">
                                <h2 id="previewArtistName" class="text-4xl sm:text-5xl font-black text-white" style="line-height: 1.1;">Your Name</h2>
                                <p id="previewTagline" class="text-lg sm:text-xl font-bold text-white opacity-90 mt-2">New Single Out Now</p>
                            </div>
                            <!-- Bottom section: Branding -->
                            <div class="text-center mt-6">
                                <p id="previewBrandName" class="font-bold text-2xl text-white">YourBrand</p>
                            </div>
                        </div>
                    </div>
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="hidden items-center justify-center flex-col">
                        <div class="w-8 h-8 border-4 border-gray-300 border-t-green-500 rounded-full animate-spin"></div>
                        <p class="mt-4 text-gray-300">Generating your image...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="hidden fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300">
        <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
            <span id="toastMessage">Card downloaded successfully!</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get all interactive elements
            const artistNameInput = document.getElementById('artistName');
            const taglineInput = document.getElementById('tagline');
            const brandNameInput = document.getElementById('brandName');
            const imageUpload = document.getElementById('imageUpload');
            const bgColorInput = document.getElementById('bgColor');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // New controls
            const colorPresets = document.querySelectorAll('.color-preset');
            const artistNameSize = document.getElementById('artistNameSize');
            const taglineSize = document.getElementById('taglineSize');
            const brandSize = document.getElementById('brandSize');
            const artistNameSizeValue = document.getElementById('artistNameSizeValue');
            const taglineSizeValue = document.getElementById('taglineSizeValue');
            const brandSizeValue = document.getElementById('brandSizeValue');
            
            // Tab controls
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // Export controls
            const formatBtns = document.querySelectorAll('.format-btn');
            const exportScale = document.getElementById('exportScale');
            const socialPresets = document.querySelectorAll('.social-preset');
            const aspectBtns = document.querySelectorAll('.aspect-btn');
            
            // State variables
            let currentFormat = 'png';
            let currentScale = 2;

            // Get all preview elements
            const promoCard = document.getElementById('promoCard');
            const previewImage = document.getElementById('previewImage');
            const previewArtistName = document.getElementById('previewArtistName');
            const previewTagline = document.getElementById('previewTagline');
            const previewBrandName = document.getElementById('previewBrandName');
            const cardPreviewWrapper = document.getElementById('cardPreviewWrapper');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const downloadBtnText = document.getElementById('downloadBtnText');
            const resetBtn = document.getElementById('resetBtn');
            
            // Text elements to be colored
            const textElements = [previewArtistName, previewTagline, previewBrandName];

            // --- TAB FUNCTIONALITY ---
            tabBtns.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    // Remove active states
                    tabBtns.forEach(b => {
                        b.classList.remove('bg-white', 'text-black');
                        b.classList.add('text-gray-400');
                    });
                    tabContents.forEach(content => content.classList.add('hidden'));
                    
                    // Add active state to clicked tab
                    btn.classList.add('bg-white', 'text-black');
                    btn.classList.remove('text-gray-400');
                    
                    // Show corresponding content
                    const tabIds = ['basicTab', 'styleTab', 'exportTab'];
                    document.getElementById(tabIds[index]).classList.remove('hidden');
                });
            });

            // --- EVENT LISTENERS ---

            // Update artist name
            artistNameInput.addEventListener('input', (e) => {
                previewArtistName.textContent = e.target.value;
                saveState();
            });

            // Update tagline
            taglineInput.addEventListener('input', (e) => {
                previewTagline.textContent = e.target.value;
                saveState();
            });

            // Update brand name
            brandNameInput.addEventListener('input', (e) => {
                previewBrandName.textContent = e.target.value;
                saveState();
            });

            // Update background color
            bgColorInput.addEventListener('input', (e) => {
                promoCard.style.backgroundColor = e.target.value;
                saveState();
            });

            // Color preset functionality
            colorPresets.forEach(preset => {
                preset.addEventListener('click', () => {
                    const color = preset.dataset.color;
                    bgColorInput.value = color;
                    promoCard.style.backgroundColor = color;
                    
                    // Visual feedback
                    colorPresets.forEach(p => p.classList.remove('ring-2', 'ring-white'));
                    preset.classList.add('ring-2', 'ring-white');
                    saveState();
                });
            });

            // Font size controls
            artistNameSize.addEventListener('input', (e) => {
                const size = e.target.value;
                previewArtistName.style.fontSize = size + 'px';
                artistNameSizeValue.textContent = size + 'px';
                saveState();
            });

            taglineSize.addEventListener('input', (e) => {
                const size = e.target.value;
                previewTagline.style.fontSize = size + 'px';
                taglineSizeValue.textContent = size + 'px';
                saveState();
            });

            brandSize.addEventListener('input', (e) => {
                const size = e.target.value;
                previewBrandName.style.fontSize = size + 'px';
                brandSizeValue.textContent = size + 'px';
                saveState();
            });

            // Aspect ratio controls
            aspectBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active state from all buttons
                    aspectBtns.forEach(b => {
                        b.classList.remove('bg-green-600', 'border-green-500');
                        b.classList.add('bg-gray-700', 'border-gray-600');
                    });
                    
                    // Add active state to clicked button
                    btn.classList.remove('bg-gray-700', 'border-gray-600');
                    btn.classList.add('bg-green-600', 'border-green-500');
                    
                    // Update card aspect ratio
                    if (btn.id === 'aspectSquare') {
                        promoCard.classList.remove('aspect-[9/16]');
                        promoCard.classList.add('aspect-square');
                    } else if (btn.id === 'aspectStory') {
                        promoCard.classList.remove('aspect-square');
                        promoCard.classList.add('aspect-[9/16]');
                    }
                    saveState();
                });
            });

            // Format selection
            formatBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active state from all buttons
                    formatBtns.forEach(b => {
                        b.classList.remove('bg-green-600', 'border-green-500');
                        b.classList.add('bg-gray-700', 'border-gray-600');
                    });
                    
                    // Add active state to clicked button
                    btn.classList.remove('bg-gray-700', 'border-gray-600');
                    btn.classList.add('bg-green-600', 'border-green-500');
                    
                    // Update current format
                    currentFormat = btn.id.replace('format', '').toLowerCase();
                    saveState();
                });
            });

            // Export scale change
            exportScale.addEventListener('change', (e) => {
                currentScale = parseInt(e.target.value);
                saveState();
            });

            // Social media presets
            document.getElementById('instagramSquare').addEventListener('click', () => {
                setCardDimensions('square');
            });

            document.getElementById('instagramStory').addEventListener('click', () => {
                setCardDimensions('story');
            });

            document.getElementById('twitterPost').addEventListener('click', () => {
                setCardDimensions('landscape');
            });

            document.getElementById('facebookPost').addEventListener('click', () => {
                setCardDimensions('landscape');
            });

            // Function to set card dimensions for social media
            function setCardDimensions(type) {
                // Remove all aspect ratio classes
                promoCard.classList.remove('aspect-square', 'aspect-[9/16]', 'aspect-[16/9]');
                
                if (type === 'square') {
                    promoCard.classList.add('aspect-square');
                    // Update aspect ratio buttons
                    document.getElementById('aspectSquare').click();
                } else if (type === 'story') {
                    promoCard.classList.add('aspect-[9/16]');
                    // Update aspect ratio buttons
                    document.getElementById('aspectStory').click();
                } else if (type === 'landscape') {
                    promoCard.classList.add('aspect-[16/9]');
                }
                
                // Visual feedback for social presets
                socialPresets.forEach(preset => {
                    preset.classList.remove('bg-green-600');
                    preset.classList.add('bg-gray-700');
                });
                event.target.classList.remove('bg-gray-700');
                event.target.classList.add('bg-green-600');
                
                saveState();
            }

            // Update image
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        previewImage.src = event.target.result;
                        saveState();
                    }
                    reader.readAsDataURL(file);
                }
            });

            // Initialize default values
            previewArtistName.style.fontSize = artistNameSize.value + 'px';
            previewTagline.style.fontSize = taglineSize.value + 'px';
            previewBrandName.style.fontSize = brandSize.value + 'px';

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + D to download
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    downloadBtn.click();
                }
                
                // Escape to clear focus
                if (e.key === 'Escape') {
                    document.activeElement.blur();
                }
            });

            // Auto-save to localStorage
            function saveState() {
                const state = {
                    artistName: artistNameInput.value,
                    tagline: taglineInput.value,
                    brandName: brandNameInput.value,
                    bgColor: bgColorInput.value,
                    artistNameSize: artistNameSize.value,
                    taglineSize: taglineSize.value,
                    brandSize: brandSize.value,
                    format: currentFormat,
                    scale: currentScale,
                    aspectRatio: promoCard.classList.contains('aspect-square') ? 'square' : 'story'
                };
                localStorage.setItem('promoCardState', JSON.stringify(state));
            }

            // Load saved state
            function loadState() {
                const saved = localStorage.getItem('promoCardState');
                if (saved) {
                    try {
                        const state = JSON.parse(saved);
                        if (state.artistName) artistNameInput.value = state.artistName;
                        if (state.tagline) taglineInput.value = state.tagline;
                        if (state.brandName) brandNameInput.value = state.brandName;
                        if (state.bgColor) bgColorInput.value = state.bgColor;
                        if (state.artistNameSize) artistNameSize.value = state.artistNameSize;
                        if (state.taglineSize) taglineSize.value = state.taglineSize;
                        if (state.brandSize) brandSize.value = state.brandSize;
                        if (state.format) currentFormat = state.format;
                        if (state.scale) currentScale = state.scale;
                        if (state.aspectRatio === 'story') {
                            document.getElementById('aspectStory').click();
                        }
                        
                        // Trigger updates
                        artistNameInput.dispatchEvent(new Event('input'));
                        taglineInput.dispatchEvent(new Event('input'));
                        brandNameInput.dispatchEvent(new Event('input'));
                        bgColorInput.dispatchEvent(new Event('input'));
                        artistNameSize.dispatchEvent(new Event('input'));
                        taglineSize.dispatchEvent(new Event('input'));
                        brandSize.dispatchEvent(new Event('input'));
                        
                        // Update format buttons
                        const formatBtn = document.getElementById('format' + currentFormat.toUpperCase());
                        if (formatBtn) formatBtn.click();
                        
                        // Update export scale
                        exportScale.value = currentScale;
                    } catch (e) {
                        console.log('Could not load saved state');
                    }
                }
            }

            // Reset functionality
            resetBtn.addEventListener('click', () => {
                if (confirm('Reset all settings to default? This cannot be undone.')) {
                    // Clear localStorage
                    localStorage.removeItem('promoCardState');
                    
                    // Reset all inputs to defaults
                    artistNameInput.value = 'Your Name';
                    taglineInput.value = 'New Single Out Now';
                    brandNameInput.value = 'YourBrand';
                    bgColorInput.value = '#1DB954';
                    artistNameSize.value = '48';
                    taglineSize.value = '20';
                    brandSize.value = '24';
                    exportScale.value = '2';
                    
                    // Reset preview image
                    previewImage.src = 'https://placehold.co/400x400/222/FFF?text=ARTIST';
                    
                    // Reset format to PNG
                    document.getElementById('formatPNG').click();
                    currentFormat = 'png';
                    currentScale = 2;
                    
                    // Reset aspect ratio to square
                    document.getElementById('aspectSquare').click();
                    
                    // Reset color presets
                    colorPresets.forEach(p => p.classList.remove('ring-2', 'ring-white'));
                    colorPresets[0].classList.add('ring-2', 'ring-white');
                    
                    // Trigger all updates
                    artistNameInput.dispatchEvent(new Event('input'));
                    taglineInput.dispatchEvent(new Event('input'));
                    brandNameInput.dispatchEvent(new Event('input'));
                    bgColorInput.dispatchEvent(new Event('input'));
                    artistNameSize.dispatchEvent(new Event('input'));
                    taglineSize.dispatchEvent(new Event('input'));
                    brandSize.dispatchEvent(new Event('input'));
                    
                    showToast('Settings reset to defaults!', 'success');
                }
            });

            // Download functionality
            downloadBtn.addEventListener('click', () => {
                // Update button text
                downloadBtnText.textContent = 'Generating...';
                
                // Show loader, hide card
                cardPreviewWrapper.style.display = 'none';
                loadingIndicator.style.display = 'flex';
                downloadBtn.disabled = true;
                downloadBtn.classList.add('opacity-50', 'cursor-not-allowed');

                // Use html2canvas to capture the promoCard element
                html2canvas(promoCard, { 
                    allowTaint: true, 
                    useCORS: true, 
                    scale: currentScale,
                    backgroundColor: null
                }).then(canvas => {
                    // Create a link element
                    const link = document.createElement('a');
                    
                    // Create filename with proper extension
                    const artistName = artistNameInput.value.replace(/\s+/g, '-').toLowerCase() || 'promo-card';
                    const fileName = `${artistName}.${currentFormat}`;
                    
                    // Set the download attribute and href based on format
                    link.download = fileName;
                    
                    if (currentFormat === 'png') {
                        link.href = canvas.toDataURL('image/png');
                    } else if (currentFormat === 'jpg') {
                        link.href = canvas.toDataURL('image/jpeg', 0.95);
                    } else if (currentFormat === 'webp') {
                        link.href = canvas.toDataURL('image/webp', 0.95);
                    }
                    
                    // Trigger the download
                    link.click();

                    // Show success toast
                    showToast(`Card downloaded as ${fileName.toUpperCase()}!`, 'success');

                    // Hide loader, show card again
                    cardPreviewWrapper.style.display = 'block';
                    loadingIndicator.style.display = 'none';
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    downloadBtnText.textContent = 'Download';

                }).catch(err => {
                    console.error("Oops, something went wrong!", err);
                    
                    // Show error toast
                    showToast('Download failed. Please try again.', 'error');
                    
                    // Hide loader, show card again even if there's an error
                    cardPreviewWrapper.style.display = 'block';
                    loadingIndicator.style.display = 'none';
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    downloadBtnText.textContent = 'Download';
                });
            });

            // Toast notification function
            function showToast(message, type = 'success') {
                toastMessage.textContent = message;
                
                if (type === 'error') {
                    toast.classList.remove('bg-green-500');
                    toast.classList.add('bg-red-500');
                } else {
                    toast.classList.remove('bg-red-500');
                    toast.classList.add('bg-green-500');
                }
                
                toast.classList.remove('hidden');
                toast.style.transform = 'translateX(100%)';
                toast.style.opacity = '0';
                
                setTimeout(() => {
                    toast.style.transform = 'translateX(0)';
                    toast.style.opacity = '1';
                }, 100);
                
                setTimeout(() => {
                    toast.style.transform = 'translateX(100%)';
                    toast.style.opacity = '0';
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 300);
                }, 3000);
            }

            // Load saved state on page load
            loadState();

            // Show welcome toast
            setTimeout(() => {
                showToast('✨ Spotify-inspired design loaded! Press Ctrl+D to download.', 'success');
            }, 1000);

            // Add version info to console
            console.log('🎨 Promo Card Generator v2.0 - Spotify Edition');
            console.log('✨ Enhanced with professional Spotify-inspired design');
            console.log('⌨️  Keyboard shortcuts: Ctrl+D (download), Escape (clear focus)');
        });
    </script>
</body>
</html>
